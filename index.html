<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ØªØ­ÙÙŠØ¸ ğŸ“‚</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet" />

    <style>
        /* --- Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† --- */
        :root {
            --primary-color: #0b1528;   /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --accent-color: #c5a059;    /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
            --bg-color: #f8fafc;        /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø© */
            --panel-bg: #ffffff;        /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ù„ÙˆØ§Ø­ */
            --border-color: #e2e8f0;    /* Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            --text-color: #1e293b;      /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
            --light-text: #64748b;      /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø¨Ø§Ù‡Øª */
            --hover-bg: #f1f5f9;        /* ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù…Ø§ÙˆØ³ */
            --glass-bg: rgba(255, 255, 255, 0.7);
            --shadow-elevation: 0 10px 25px rgba(0, 0, 0, 0.05);

            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ */
            --icon-pdf: #e11d48; --icon-word: #2563eb; --icon-excel: #16a34a;
            --icon-ppt: #ea580c; --icon-img: #c5a059; --icon-video: #8b5cf6;
            --icon-audio: #06b6d4; --icon-text: #64748b;
        }

        /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… --- */
        body.dark-mode {
            --bg-color: #0f172a; --panel-bg: #1e293b; --border-color: #334155;
            --text-color: #f1f5f9; --light-text: #94a3b8; --hover-bg: #334155;
            --glass-bg: rgba(30, 41, 59, 0.8);
        }

        body { font-family: "Almarai", sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-color); display: flex; min-height: 100vh; transition: 0.3s ease; }
        .container { display: flex; width: 100%; flex-grow: 1; }

        /* --- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ --- */
        .sidebar {
            width: 380px; background-color: var(--panel-bg); border-left: 1px solid var(--border-color);
            display: flex; flex-direction: column; box-shadow: var(--shadow-elevation);
            position: sticky; top: 0; height: 100vh; z-index: 100;
        }

        .sidebar-header { background-color: var(--primary-color); padding: 25px; color: white; border-bottom: 3px solid var(--accent-color); }
        .sidebar-header h2 { font-size: 1.1em; margin: 15px 0 0; color: var(--accent-color); text-align: center; line-height: 1.6; }

        /* --- Ø§Ù„Ø¨Ø§ØªØ±Ù† Ø§Ù„Ø°Ù‡Ø¨ÙŠ (Ø§Ù„ÙØ§ØµÙ„) --- */
        .golden-divider {
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, var(--accent-color), transparent);
            margin: 0 15px;
            display: inline-block;
            opacity: 0.6;
        }

        .admin-controls { padding: 20px; display: flex; flex-direction: column; gap: 15px; }

        .side-input {
            width: 100%; padding: 12px 15px; border: 1px solid var(--border-color);
            border-radius: 15px; background: var(--glass-bg); backdrop-filter: blur(10px);
            color: var(--text-color); font-family: inherit; transition: 0.3s;
            box-sizing: border-box; outline: none;
        }
        .side-input:focus { border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(197, 160, 89, 0.2); }

        .upload-btn {
            width: 100%; padding: 15px; border: none; border-radius: 15px;
            cursor: pointer; font-weight: bold; font-family: inherit;
            background: linear-gradient(135deg, var(--accent-color), #a38145);
            color: white; box-shadow: 0 4px 15px rgba(197, 160, 89, 0.3);
            display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s;
        }

        /* --- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª --- */
        .file-list-container { overflow-y: auto; flex-grow: 1; }
        .file-row { cursor: pointer; border-bottom: 1px solid var(--border-color); transition: 0.2s; position: relative; }
        .file-row:hover { background-color: var(--hover-bg); }
        .file-row.active { background-color: rgba(197, 160, 89, 0.1); border-right: 5px solid var(--accent-color); }
        
        .file-info { display: flex; flex-direction: column; padding: 15px 70px 15px 15px; }
        .file-info .name { font-weight: 700; font-size: 0.95em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
        .file-icon-fixed { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 1.5em; }

        .row-actions { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); display: flex; gap: 12px; }

        /* --- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(11, 21, 40, 0.8); backdrop-filter: blur(8px); }
        .modal-content { 
            background: var(--panel-bg); margin: 10% auto; padding: 35px; width: 90%; max-width: 420px; 
            border-radius: 25px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1); animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* --- Ø§Ù„Ù…Ø¹Ø§ÙŠÙ† --- */
        .main-content { flex-grow: 1; padding: 25px; display: flex; flex-direction: column; background-color: var(--bg-color); }
        .viewer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); }
        #viewer { flex-grow: 1; background: #d1d5db; border-radius: 20px; overflow: hidden; position: relative; box-shadow: var(--shadow-elevation); }
        iframe, video, img { width: 100%; height: 100%; border: none; background: white; }

        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; position: static; }
            #viewer { min-height: 500px; }
        }
    </style>
</head>
<body>

    <div id="tokenModal" class="modal">
        <div class="modal-content">
            <div style="font-size: 3em; color: var(--accent-color); margin-bottom: 15px;"><i class="fa-solid fa-lock"></i></div>
            <h3>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
            <p style="color: var(--light-text);">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</p>
            <input type="password" id="tokenInput" class="side-input" style="text-align: center; letter-spacing: 5px;" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="upload-btn" onclick="saveToken()" style="flex:2;">ØªØ£ÙƒÙŠØ¯</button>
                <button class="side-input" onclick="closeModal('tokenModal')" style="flex:1;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <div style="margin-bottom: 20px;">
                <i class="fa-solid fa-door-open fa-4x" style="color: var(--accent-color); position: relative;">
                    <i class="fa-solid fa-arrow-right" style="font-size: 0.4em; position: absolute; left: -12px; top: 30%;"></i>
                </i>
            </div>
            <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬</h3>
            <p style="color: var(--light-text);">Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="upload-btn" onclick="executeLogout()" style="flex:1;">Ø®Ø±ÙˆØ¬</button>
                <button class="side-input" onclick="closeModal('logoutModal')" style="flex:1; background: #64748b; color: white;">ØªØ±Ø§Ø¬Ø¹</button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal"><div class="modal-content">
        <i class="fa-solid fa-circle-exclamation fa-4x" style="color:#ef4444; margin-bottom:15px;"></i>
        <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ</h3>
        <p id="deleteMsg" style="color:var(--light-text)"></p>
        <div style="display:flex; gap:10px;">
            <button class="upload-btn" style="background:#ef4444;" onclick="executeDelete()">Ø­Ø°Ù</button>
            <button class="side-input" onclick="closeModal('deleteModal')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div></div>

    <div id="renameModal" class="modal"><div class="modal-content">
        <h3>Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù</h3>
        <input type="text" id="newNameInput" class="side-input">
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="upload-btn" onclick="executeRename()">Ø­ÙØ¸</button>
            <button class="side-input" onclick="closeModal('renameModal')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div></div>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="display: flex; align-items: center;">
                        <i class="fa-solid fa-right-from-bracket" onclick="openModal('logoutModal')" style="cursor:pointer; font-size:1.2em; color: var(--accent-color);"></i>
                        
                        <span class="golden-divider"></span>
                        
                        <i id="theme-icon" class="fa-solid fa-moon" onclick="toggleTheme()" style="cursor:pointer; font-size:1.2em; color: var(--accent-color);"></i>
                    </div>
                </div>
                <h2>Ù…Ø³ØªØ¹Ø±Ø¶ Ù…Ù„ÙØ§Øª Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ© ğŸ“‚</h2>
            </div>

            <div class="admin-controls">
                <input type="file" id="upload-input" style="display: none;" />
                <button class="upload-btn" onclick="checkAuthAndUpload()">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯
                </button>
                
                <input type="text" id="search-input" class="side-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..." oninput="renderList(allFiles)">
                
                <select id="file-filter" class="side-input" onchange="renderList(allFiles)">
                    <option value="all">ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</option>
                    <option value="fav">â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</option>
                    <option value="pdf">ğŸ“„ Ù…Ù„ÙØ§Øª PDF</option>
                    <option value="doc">ğŸ“ Ù…Ø³ØªÙ†Ø¯Ø§Øª Word</option>
                    <option value="xls">ğŸ“Š Ø¬Ø¯Ø§ÙˆÙ„ Excel</option>
                    <option value="ppt">ğŸ“½ï¸ Ø¹Ø±ÙˆØ¶ PowerPoint</option>
                    <option value="img">ğŸ–¼ï¸ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØ±</option>
                    <option value="video">ğŸ¥ Ù…Ù„ÙØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</option>
                    <option value="audio">ğŸµ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª</option>
                    <option value="txt">ğŸ“‘ Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ©</option>
                </select>
                <div id="upload-status" style="text-align:center; font-weight:bold; font-size:0.85em; min-height:20px;"></div>
            </div>
            
            <div class="file-list-container">
                <div id="file-list"></div>
            </div>

            <div style="padding:15px; text-align:center; font-size:0.8em; background:var(--primary-color); color:white;">
               Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± NMO Â© 2026
            </div>
        </aside>

        <main class="main-content">
            <div class="viewer-header">
                <h2 id="current-file-name" style="margin:0; font-size: 1.3em; color:var(--primary-color)">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ù„Ø¹Ø±Ø¶Ù‡</h2>
                <a href="#" id="download-btn" target="_blank" style="display:none; background:var(--accent-color); color:white; padding:10px 20px; border-radius:12px; text-decoration:none; font-weight:bold;">
                    <i class="fa-solid fa-download"></i> ØªØ­Ù…ÙŠÙ„
                </a>
            </div>
            <div id="viewer">
                <div style="text-align: center; opacity: 0.3; padding-top: 150px;">
                    <i class="fa-solid fa-file-signature fa-5x"></i>
                    <p>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub --- */
        const CONFIG = { 
            username: 'nmoschool', 
            repo: 'teacher', 
            branch: 'main', 
            path: 'files' 
        };

        let allFiles = [], favorites = JSON.parse(localStorage.getItem('file_stars')) || [];
        let pendingAction = null, renameTarget = null, deleteTarget = null;

        /* --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… --- */
        function getStoredToken() { return localStorage.getItem('github_token'); }
        function openModal(id) { document.getElementById(id).style.display='block'; }
        function closeModal(id) { document.getElementById(id).style.display='none'; }
        function saveToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (token) { localStorage.setItem('github_token', token); closeModal('tokenModal'); if (pendingAction) pendingAction(); }
        }
        function executeLogout() { localStorage.removeItem('github_token'); location.reload(); }

        /* --- Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ --- */
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            body.classList.toggle('dark-mode');
            icon.classList.toggle('fa-sun'); icon.classList.toggle('fa-moon');
            icon.style.color = 'var(--accent-color)'; // Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ø¯Ø§Ø¦Ù…
        }

        /* --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª --- */
        async function loadFromGithub() {
            const list = document.getElementById("file-list");
            list.innerHTML = '<div style="padding:20px; text-align:center;"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}?ref=${CONFIG.branch}`);
                const data = await res.json();
                if (Array.isArray(data)) {
                    allFiles = data.filter(item => item.type === 'file').reverse();
                    renderList(allFiles);
                }
            } catch (e) { list.innerHTML = '<p style="color:red; text-align:center;">Ø®Ø·Ø£ Ø§ØªØµØ§Ù„</p>'; }
        }

        /* --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª --- */
        function getFileData(name) {
            const ext = name.split('.').pop().toLowerCase();
            if (ext === 'pdf') return { icon: 'fa-file-pdf', color: 'var(--icon-pdf)', type: 'pdf' };
            if (['doc', 'docx'].includes(ext)) return { icon: 'fa-file-word', color: 'var(--icon-word)', type: 'doc' };
            if (['xls', 'xlsx'].includes(ext)) return { icon: 'fa-file-excel', color: 'var(--icon-excel)', type: 'xls' };
            if (['ppt', 'pptx'].includes(ext)) return { icon: 'fa-file-powerpoint', color: 'var(--icon-ppt)', type: 'ppt' };
            if (['jpg', 'jpeg', 'png', 'gif', 'svg'].includes(ext)) return { icon: 'fa-file-image', color: 'var(--icon-img)', type: 'img' };
            if (['mp4', 'mov', 'webm'].includes(ext)) return { icon: 'fa-file-video', color: 'var(--icon-video)', type: 'video' };
            if (['mp3', 'wav', 'ogg'].includes(ext)) return { icon: 'fa-file-audio', color: 'var(--icon-audio)', type: 'audio' };
            return { icon: 'fa-file-lines', color: 'var(--icon-text)', type: 'txt' };
        }

        /* --- Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª --- */
        function renderList(files) {
            const list = document.getElementById("file-list");
            const filter = document.getElementById("file-filter").value;
            const search = document.getElementById("search-input").value.toLowerCase();
            list.innerHTML = '';
            
            let filtered = files.filter(f => f.name.toLowerCase().includes(search));
            if (filter === 'fav') filtered = filtered.filter(f => favorites.includes(f.name));
            else if (filter !== 'all') filtered = filtered.filter(f => getFileData(f.name).type === filter);
            
            filtered.forEach(file => {
                const info = getFileData(file.name);
                const isStarred = favorites.includes(file.name);
                const div = document.createElement("div");
                div.className = "file-row";
                div.innerHTML = `
                    <div class="file-icon-fixed"><i class="fa-solid ${info.icon}" style="color:${info.color}"></i></div>
                    <div class="file-info">
                        <span class="name">${file.name}</span>
                        <span style="font-size:0.75em; color:var(--light-text)">${info.type.toUpperCase()}</span>
                    </div>
                    <div class="row-actions">
                        <i class="fa-solid fa-star" style="color:${isStarred ? 'var(--accent-color)' : '#cbd5e1'}" onclick="toggleStar(event, '${file.name}')"></i>
                        <i class="fa-solid fa-pen" style="color:var(--accent-color)" onclick="openRenameModal(event, ${JSON.stringify(file).replace(/"/g, '&quot;')})"></i>
                        <i class="fa-solid fa-trash" style="color:#ef4444;" onclick="openDeleteModal(event, '${file.name}', '${file.sha}')"></i>
                    </div>
                `;
                div.onclick = () => {
                    document.querySelectorAll('.file-row').forEach(r => r.classList.remove('active'));
                    div.classList.add('active');
                    openFile(file.name, file.download_url);
                };
                list.appendChild(div);
            });
        }

        /* --- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„ÙØ§Øª --- */
        function openFile(name, url) {
            document.getElementById("current-file-name").innerText = name;
            const viewer = document.getElementById("viewer");
            const ext = name.split('.').pop().toLowerCase();
            document.getElementById("download-btn").style.display = "inline-flex";
            document.getElementById("download-btn").href = url;
            viewer.innerHTML = '<div style="padding:50px; text-align:center;"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';
            
            setTimeout(() => {
                if (['mp4', 'mov', 'webm'].includes(ext)) viewer.innerHTML = `<video controls autoplay><source src="${url}"></video>`;
                else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) viewer.innerHTML = `<img src="${url}" style="object-fit:contain;">`;
                else if (['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'].includes(ext)) {
                    viewer.innerHTML = `<iframe src="https://docs.google.com/gview?url=${encodeURIComponent(url)}&embedded=true"></iframe>`;
                } else viewer.innerHTML = `<div style="text-align:center; padding-top:100px;"><p>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø©</p></div>`;
            }, 300);
        }

        /* --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª --- */
        function toggleStar(e, name) {
            e.stopPropagation();
            if (favorites.includes(name)) favorites = favorites.filter(f => f !== name);
            else favorites.push(name);
            localStorage.setItem('file_stars', JSON.stringify(favorites));
            renderList(allFiles);
        }

        function checkAuthAndUpload() {
            if (!getStoredToken()) { pendingAction = () => document.getElementById('upload-input').click(); openModal('tokenModal'); }
            else document.getElementById('upload-input').click();
        }

        document.getElementById('upload-input').addEventListener('change', async (e) => {
            const file = e.target.files[0]; if (!file) return;
            const status = document.getElementById('upload-status');
            status.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = async () => {
                const content = reader.result.split(',')[1];
                const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}/${file.name}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${getStoredToken()}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Upload: ${file.name}`, content, branch: CONFIG.branch })
                });
                if (res.ok) { status.innerHTML = "âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹"; loadFromGithub(); }
                else status.innerHTML = "âŒ Ø®Ø·Ø£ (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²)";
            };
        });

        function openDeleteModal(e, n, s) { e.stopPropagation(); deleteTarget = { name: n, sha: s }; document.getElementById('deleteMsg').innerText = n; openModal('deleteModal'); }
        async function executeDelete() {
            if(!getStoredToken()) { openModal('tokenModal'); return; }
            const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}/${deleteTarget.name}`, {
                method: 'DELETE',
                headers: { 'Authorization': `token ${getStoredToken()}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: `Delete: ${deleteTarget.name}`, sha: deleteTarget.sha, branch: CONFIG.branch })
            });
            if (res.ok) { closeModal('deleteModal'); loadFromGithub(); }
        }

        function openRenameModal(e, f) { e.stopPropagation(); renameTarget = f; document.getElementById('newNameInput').value = f.name; openModal('renameModal'); }
        async function executeRename() {
            const newN = document.getElementById('newNameInput').value.trim();
            if(!newN || newN === renameTarget.name) { closeModal('renameModal'); return; }
            if(!getStoredToken()) { openModal('tokenModal'); return; }
            closeModal('renameModal');
            document.getElementById('upload-status').innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„...";
            try {
                const fRes = await fetch(renameTarget.download_url);
                const blob = await fRes.blob();
                const reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onloadend = async () => {
                    const content = reader.result.split(',')[1];
                    const putRes = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}/${newN}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${getStoredToken()}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `Rename: ${newN}`, content, branch: CONFIG.branch })
                    });
                    if (putRes.ok) {
                        await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}/${renameTarget.name}`, {
                            method: 'DELETE',
                            headers: { 'Authorization': `token ${getStoredToken()}`, 'Content-Type': 'application/json' },
                            body: JSON.stringify({ message: `Cleanup`, sha: renameTarget.sha, branch: CONFIG.branch })
                        });
                        loadFromGithub();
                        document.getElementById('upload-status').innerHTML = "";
                    }
                };
            } catch (e) { document.getElementById('upload-status').innerHTML = "âŒ Ø®Ø·Ø£"; }
        }

        loadFromGithub();
    </script>
</body>
</html>
